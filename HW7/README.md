# HW6

**Выдано: 07.04.2024, дедлайн 17.04.2024 18:59 по МСК**

## Важно: автоматические 0 баллов за работу, если:

* Красный CI (даже если падает только scalafmt);
* Если CI проходит, **но было выполнено 0 тестов**;

## Играемся с эффектами - Env

В одном из домашних заданий вы уже пробовали реализовать свой type class `Env`, в этом задании мы попробуем
модифицировать уже имеющийся. Библиотека `cats-effect` предоставляет type class для работы с переменными окружения:

```scala
trait Env[F[_]] {
  def get(name: String): F[Option[String]]

  def entries: F[Iterable[(String, String)]]
}
```

Вам предлагается написать свой type class для работы с переменными окружения расширив уже имеющийся новым функционалом,
а именно возможностью добавления в окружение новых переменных. В этом задании обойдёмся псевдо-добавлением новых
переменных окружения: вам не нужно делать системные вызовы для добавления переменных в окружение, вы должны хранить все
добавленные переменные локально и при вызове проверять есть ли значение локально, а только потом проверять внешние.

### Задание

За вас уже написали определение, вам требуется только добавить реализацию.

```scala
trait LocalEnv[F[_]] extends Env[F] {
  def set(name: String, value: String): F[Unit]
}
```

Допишите тесты если требуется (писать тесты больше не обязательно, только если из-за этого не проходят доп проверки на
coverage).

Вам так же требуется добавить функцию для работы с консолью (`Application.consoleApplication`), она умеет обрабатывать
всего 3 команды:

* `exit` - выйти и успешно завершить программу;
* `set <key> <value>` - установить переменную окружения (локального); Вывод - `'<key>' '<value>'`;
* `get <key>` - получить переменную окружения; Вывод - `'<key>' '<value>'` если значение найдено и `Not found` иначе;
* В случае получения неизвестной команды - вывести в консоль `Unknown command` и ждать следующего пользовательского
  ввода.

Пример работы:

```text
> get HTTP_PORT
< Not found
> set HTTP_PORT 8080
< 'HTTP_PORT' '8080'
> get HTTP_PORT
< 'HTTP_PORT' '8080'
> set HTTP_PORT  80
< 'HTTP_PORT' '80'
> get HTTP_PORT
< 'HTTP_PORT' '80'
> get LANG
< 'LANG' 'C.UTF-8'
> set LANG C.UTF-16
< 'LANG' 'C.UTF-16'
> get LANG
< 'LANG' 'C.UTF-16'
> exit
```

### Примеры работы с эффектами

#### Ref

```scala
def example[F[_] : Ref.Make : Monad](): F[Int] =
  for {
    ref: Ref[F, Int] <- Ref.of(42)        // Инициализировать Ref значением 42
    _: Unit          <- ref.update(_ + 5) // Обновить добавив 5
    result: Int      <- ref.get           // Получить значение
  } yield result
```

#### Console

```scala
def helloWorld[F[_] : Console : FlatMap](): F[Unit] =
  for {
    _    <- Console[F].println("What your name?")
    name <- Console[F].readLine
    _    <- Console[F].println(s"Hello $name!")
  } yield ()
```

## Ссылки:

* [Env](https://typelevel.org/cats-effect/docs/std/env)
* [Ref](https://typelevel.org/cats-effect/docs/std/ref)
* [Console](https://typelevel.org/cats-effect/docs/std/console)
* [Cats-effect](https://typelevel.org/cats-effect/docs/getting-started)
* [cats-effect-testing](https://github.com/typelevel/cats-effect-testing)

### Code Style:

Мы последовательно вводим список запрещенных механик, которыми нельзя пользоваться при написании кода, и рекомендаций по
code style. За нарушения мы оставляем за собой право **снижать оценку**.

* Переменные и функции должны иметь осмысленные названия;
* Переменные, функции, названия должны быть в `camelCase`;
* Тест классы именуются `<ClassName>Spec`, где `<ClassName>` - класс к которому пишутся тесты;
* Тест классы находятся в том же пакете, что и класс к которому пишутся тесты (например, класс `WeekDay` находится в
  пакете `weekday` в директории `src/main/scala/weekday`, значит его тест класс `WeekDaySpec` должен быть в том же
  пакете в директории `src/test/scala/weekday`);
* Каждый тест должен быть в отдельном test suite;
* Использовать _java_ коллекции запрещается (используйте `Scala` коллекции);
* Использовать `mutable` коллекций запрещается (используйте `immutable` коллекции);
* Использовать `var` запрещается (используйте `Ref`);
* Использовать `return` запрещается;
* Использовать `this` запрещается (используйте `self` внутри класса);
* Использовать `throw` запрещено (используйте `Either` или `Option`);
* Использование не безопасных вызовов **разрешено только в тестах** (например `.get` у `Option`);
* Использование `is/asInstanceOf` запрещено (используйте `match`);
* Не используйте `match`, когда достаточно `map`;
* Не используйте `fold`, когда достаточно `map`;
* Использовать `try` запрещено (используйте `Either` или `ApplicativeError`);
* Старайтесь не использовать вложенные `match` (используйте `map`/`flatMap`/`traverse`);
* Использование циклов (`while`/`for`) запрещено (используйте методы `while`/`iterate` у `Monad`)
* Использование `implicitly[???]` не в тестах запрещено (если есть `summon` метод используйте его, иначе
  принимайте `implicit` параметр по имени)
* Использование вызовов `Functor[F].map(fa)(f)` и подобных у тайпклассов `Monad`/`Applicative`/`Functor` запрещено
  (используйте синтаксис например `import cats.syntax.functor._`)

* **Временно разрешается использовать импорт** `import cats.syntax.all._` - он предоставляет весь синтаксис

PS: Правила работают по логике всё что не запрещено - то разрешено.